<modal-cancel-button modal-instance="modalInstance" ng-show="modalInstance !== undefined"></modal-cancel-button>
<div class="evaluate-screen">

    <h1>Compare Answers</h1>

    <p class="intro-text">
        For each round, choose which answer better matches the criteria below, give helpful feedback on both answers in the pair, and submit the comparison.
        Please note <strong>answers are not automatically saved</strong> as you type.
        However, you may manually save a draft of the round below.
    </p>

    <p class="assignment-toggle"><a href="" ng-click="showAssignment = !showAssignment">
        <i class="fa fa-chevron-down" ng-show="showAssignment "></i>
        <i class="fa fa-chevron-right" ng-hide="showAssignment "></i>
        Show assignment "{{assignment.name}}"
    </a></p>

    <div ng-show="showAssignment " class="standalone-assignment">
        <h2><i class="fa fa-comments"></i> {{assignment.name}}</h2>
        <ckeditor-html-content html-content="assignment.description"></ckeditor-html-content>
        <!-- Attachment -->
        <compair-attachment-inline label="See assignment details:" attachment="assignment.file"></compair-attachment-inline>
    </div>

    <div class="row answer-pair">

        <hr />

        <div class="h3 text-center" ng-show="showCountDown && !comparisonsError">
            <timer end-time="assignment.compare_end">
                <span ng-show="minutes > 0 || seconds > 0" title="Official time remaining until deadline" class="bg-danger alert text-danger"><i class="glyphicon glyphicon-time"></i> {{minutes}} minutes {{seconds}} seconds left</span>
                <span ng-show="minutes == 0 && seconds == 0" class="bg-danger alert text-danger"><i class="glyphicon glyphicon-time"></i> DEADLINE REACHED</span>
            </timer>
            <br /><br />
            <span class="h4">(Comparison must be submitted before deadline to be accepted)</span>
        </div>

        <h2 class="col-md-6">Answer Pair</h2>
        <h2 class="col-md-6 text-right rounds"><span ng-hide="comparisonsError" class="label label-warning">
            Round {{current}} <span ng-if="!canManageAssignment">/ {{total}}</span>
        </h2>

        <div ng-show="comparisonsError" class="alert alert-info" role="alert">
            <p><strong>Break time!</strong> You've compared the currently available answer pairs. Please check back later to compare new pairs after more answers have been submitted.</p>
        </div>

        <div class="col-md-6" ng-hide="comparisonsError">
            <div class="answer-choice clearfix">
                <h3 class="text-center">Answer {{firstAnsNum}}</h3>
                <ckeditor-html-content html-content="answer1.content"></ckeditor-html-content>
                <!-- Attachment -->
                <compair-attachment-inline label="See detail:"
                    attachment="answer1.file" download-name="'Answer #'+firstAnsNum">
                </compair-attachment-inline>
                <!-- Flagging -->
                <div ng-repeat="key in $root">{{key}}</div>
                <a href="" class="btn btn-default btn-xs pull-right"
                    title="Flag as incomplete or inappropriate."
                    ng-class="{'btn-danger': answer1.flagged}"
                    ng-click="toggleAnswerFlag(answer1)">
                    <i class="fa fa-warning"></i>
                    <span ng-if="answer1.flagged">Flagged</span>
                    <span ng-if="!answer1.flagged">Flag</span>
                </a>
            </div>
        </div>

        <div class="col-md-6" ng-hide="comparisonsError">
            <div class="answer-choice clearfix">
                <h3 class="text-center">Answer {{secondAnsNum}}</h3>
                <ckeditor-html-content html-content="answer2.content"></ckeditor-html-content>
                <!-- Attachment -->
                <compair-attachment-inline label="See detail:"
                    attachment="answer2.file" download-name="'Answer #'+secondAnsNum">
                </compair-attachment-inline>
                <!-- Flagging -->
                <a href="" class="btn btn-default btn-xs pull-right"
                    title="Flag as incomplete or inappropriate."
                    ng-class="{'btn-danger': answer2.flagged}"
                    ng-click="toggleAnswerFlag(answer2)">
                    <i class="fa fa-warning"></i>
                    <span ng-if="answer2.flagged">Flagged</span>
                    <span ng-if="!answer2.flagged">Flag</span>
                </a>
            </div>
        </div>

    </div>

    <form name="comparisonForm" ng-submit="comparisonSubmit(comparisonForm)" novalidate ng-hide="comparisonsError" confirm-form-exit form-type="compare">

        <div>

            <hr />

            <h3>1) Choose the answer that best meets the criteria below</h3>

            <div ng-if="assignment.criteria.length == 0" class="text-center">
                <p>No criteria have been set for this assignment yet. Please select one or more criteria.</p>
                <br />
            </div>

            <div class="form-group sub-step" ng-repeat="comparison in comparisons">

                <div class="each-criterion sub-step">
                    <fieldset>
                        <div class="row">
                            <div class="col-sm-8">
                                <h4><i class="fa fa-gavel"></i> {{comparison.criterion.name}}</h4>
                                <hr />
                                <ckeditor-html-content class="criteria" html-content="comparison.criterion.description"></ckeditor-html-content>
                            </div>
                            <div class="col-sm-4 text-center">
                                <p><strong>Select one:</strong></p>
                                <div class="btn-group">
                                    <label class="btn btn-primary" ng-class=
                                        "{active:comparison.winner_id==answer1.id}">
                                        <input type="radio" class="hideRadio"
                                            name="answer{{answer1.id}}" required
                                            ng-model="comparison.winner_id"
                                            ng-change="trackComparisonWinner(comparison)"
                                            ng-value="answer1.id">
                                        Answer {{firstAnsNum}}
                                    </label>
                                    <label class="btn btn-primary" ng-class=
                                        "{active:comparison.winner_id==answer2.id}">
                                        <input type="radio" class="hideRadio"
                                            name="answer{{answer2.id}}" required
                                            ng-model="comparison.winner_id"
                                            ng-change="trackComparisonWinner(comparison)"
                                            ng-value="answer2.id">
                                        Answer {{secondAnsNum}}
                                    </label>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                </div>

            </div>

            <hr />

            <h3>2) Give detailed feedback to the author of each answer</h3>

            <div class="row sub-step">

                <p class="intro-text">Use any instructor-provided guidelines or answer general questions, based on the criteria above: <strong>What did the author do well? Where might the author improve?</strong> Remember to make your comments&mdash;including criticisms&mdash;encouraging, respectful, and specific.</p>

                <div class="col-md-6">
                    <label class="cke-label">
                        Your feedback for Answer {{firstAnsNum}} (shown to instructors and author)
                        <i class="fa fa-arrow-down"></i>
                    </label>
                    <textarea
                        ng-model="answer1.comment.content" rows="8" ckeditor="editor1Options" required>
                    </textarea>
                </div>
                <div class="col-md-6">
                    <label class="cke-label">
                        Your feedback for Answer {{secondAnsNum}} (shown to instructors and author)
                        <i class="fa fa-arrow-down"></i>
                    </label>
                    <textarea
                        ng-model="answer2.comment.content" rows="8" ckeditor="editor2Options" required>
                    </textarea>
                </div>
            </div>
        </div>

        <div class="form-group sub-step text-center">
            <input ng-disabled="submitted" type="submit"
                ng-click="$parent.isDraft = true"
                value="Save Draft" class="btn btn-default btn-lg" />
            &nbsp; &nbsp;
            <!-- button to submit and refresh page IF evaluations remain for user -->
            <input ng-disabled="comparisonForm.$invalid || submitted" type="submit"
                ng-click="$parent.isDraft = false"
                value="Submit" class="btn btn-success btn-lg" />
            <p ng-if="submitted">
                <i class="fa fa-spin fa-spinner"></i>
                &nbsp; Saving comparison...
            </p>
        </div>

    </form>

</div>

